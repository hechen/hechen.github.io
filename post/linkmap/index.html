<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>通过 LinkMap 做崩溃日志分发 - I make stuff</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="chen" />
  <meta name="description" content="LinkMap 是什么？ 我们编写的代码都是要经过编译，链接等一步一步生成可执行文件。而 LinkMap 文件是 Xcode 产生可执行文件的同时生成的链接信息，用来描述可执行文件的构" />

  <meta name="keywords" content="Chen, iOS, Swift, Productivity, macOS, Cocoa" />






<meta name="generator" content="Hugo 0.55.3" />


<link rel="canonical" href="https://hechen.xyz/post/linkmap/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="通过 LinkMap 做崩溃日志分发" />
<meta property="og:description" content="LinkMap 是什么？ 我们编写的代码都是要经过编译，链接等一步一步生成可执行文件。而 LinkMap 文件是 Xcode 产生可执行文件的同时生成的链接信息，用来描述可执行文件的构" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hechen.xyz/post/linkmap/" />
<meta property="article:published_time" content="2018-11-18T17:29:54&#43;08:00"/>
<meta property="article:modified_time" content="2019-04-01T10:20:38&#43;08:00"/>

<meta itemprop="name" content="通过 LinkMap 做崩溃日志分发">
<meta itemprop="description" content="LinkMap 是什么？ 我们编写的代码都是要经过编译，链接等一步一步生成可执行文件。而 LinkMap 文件是 Xcode 产生可执行文件的同时生成的链接信息，用来描述可执行文件的构">


<meta itemprop="datePublished" content="2018-11-18T17:29:54&#43;08:00" />
<meta itemprop="dateModified" content="2019-04-01T10:20:38&#43;08:00" />
<meta itemprop="wordCount" content="3423">



<meta itemprop="keywords" content="Crash,LinkMap,Dispatch," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="通过 LinkMap 做崩溃日志分发"/>
<meta name="twitter:description" content="LinkMap 是什么？ 我们编写的代码都是要经过编译，链接等一步一步生成可执行文件。而 LinkMap 文件是 Xcode 产生可执行文件的同时生成的链接信息，用来描述可执行文件的构"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Chen</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/about/">About</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Chen
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hechen.xyz/about/">About</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">通过 LinkMap 做崩溃日志分发</h1>
      
      <div class="post-meta">
        <time datetime="2018-11-18" class="post-time">
          2018-11-18
        </time>
        <div class="post-category">
            <a href="https://hechen.xyz/categories/ios/"> iOS </a>
            
          </div>
        

        
        

        
        
          <span id="/post/linkmap/" class="leancloud_visitors" data-flag-title="通过 LinkMap 做崩溃日志分发">
            <span class="post-meta-item-text"> | 阅读 </span>
            <span class="leancloud-visitors-count"></span>
          </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#linkmap-是什么">LinkMap 是什么？</a></li>
<li><a href="#如何生成">如何生成？</a></li>
<li><a href="#linkmap-内容解析">LinkMap 内容解析</a>
<ul>
<li><a href="#头部基础信息">头部基础信息</a></li>
<li><a href="#类信息">类信息</a></li>
<li><a href="#段信息">段信息</a></li>
<li><a href="#符号信息">符号信息</a></li>
</ul></li>
<li><a href="#linkmap-能用来做什么">LinkMap 能用来做什么？</a></li>
<li><a href="#注意事项">注意事项：</a>
<ul>
<li><a href="#关于-symbol-匹配规则">关于 Symbol 匹配规则</a></li>
</ul></li>
<li><a href="#crash-解析">Crash 解析</a></li>
<li><a href="#参考链接">参考链接</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h2 id="linkmap-是什么">LinkMap 是什么？</h2>

<p>我们编写的代码都是要经过编译，链接等一步一步生成可执行文件。而 LinkMap 文件是 Xcode 产生可执行文件的同时生成的链接信息，用来描述可执行文件的构造成分，包括代码段（<strong>TEXT）和数据段（</strong>DATA）的分布情况。LinkMap 说白了就是整个链接过程中涉及到的目标文件的记录，它是一个纯文本文件。</p>

<h2 id="如何生成">如何生成？</h2>

<p>具体生成需要 Xcode 配合开启某个参数，具体在对应 App 的主 Target 的 Build Setting 选项里，参数为 Write Link Map File，将其修改为 YES，即可在编译阶段生成对应的 Link Map 文件。 对应 Proj 文件中的参数为 LD_GENERATE_MAP_FILE</p>

<p><img src="https://i.imgur.com/wpKkAGW.png" alt="" /></p>

<p>LinkMap 文件生成的默认地址如下，其实在上图中的 Path to Link Map File 就能看到，可以指定不同 Scheme 下的文件路径，我这里直接使用默认路径了（只是有点长）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">$(TARGET_TEMP_DIR)/$(PRODUCT_NAME)-LinkMap-$(CURRENT_VARIANT)-$(CURRENT_ARCH).txt</pre></td></tr></table>
</div>
</div>
<p>那实际在我的电脑上，结合知乎 iOS 工程，编译完成之后在 DerivedData 目录下会生成一堆 build 副产品，其中名称为 {Target}-LinkMap-xxx.txt 文件就是我们所说的 LinkMap 文件。如下图所示：</p>

<p><img src="https://i.imgur.com/24Su9xe.png" alt="" /></p>

<h2 id="linkmap-内容解析">LinkMap 内容解析</h2>

<p>使用知乎主项目 Debug Scheme 下编译完成之后，在 Derived Data 目录下生成的 LinkMap 文件大小达到了 120+M。其本质上是一个 txt 文件，我们看下主要包含几个部分：</p>

<h3 id="头部基础信息">头部基础信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span></pre></td>
<td class="lntd">
<pre class="chroma">Path: /Users/chen/Library/Developer/Xcode/DerivedData/osee2unified-fwevarpdypzxobaetkykvdvesdbf/Build/Products/Debug-iphonesimulator/osee2unifiedRelease.app/osee2unifiedRelease
Arch: x86_64</pre></td></tr></table>
</div>
</div>
<h3 id="类信息">类信息</h3>

<p>列举可执行文件中所有的 .obj 文件，如下所示，第一列为对应的类文件编号，我们在代码文件中编译完成的类都会生成一个对应的 Object File. 其中第一列的文件编号在后续符号进行查找回溯来源的时候有用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></pre></td>
<td class="lntd">
<pre class="chroma">    # Object files:
    
    [ 0] linker synthesized
    [ 1] dtrace
    [ 2] /Users/chen/Library/Developer/Xcode/DerivedData/osee2unified-fwevarpdypzxobaetkykvdvesdbf/Build/Intermediates.noindex/osee2unified.build/Debug-iphonesimulator/osee2unifiedRelease.build/Objects-normal/x86_64/ZHEmailAutocompleteTextField.o
    [ 3] /Users/chen/Library/Developer/Xcode/DerivedData/osee2unified-fwevarpdypzxobaetkykvdvesdbf/Build/Intermediates.noindex/osee2unified.build/Debug-iphonesimulator/osee2unifiedRelease.build/Objects-normal/x86_64/ZHURLProtocolStartupItem.o
    ...
    [7808] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftQuartzCore.dylib
    [7809] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftCore.dylib
    [7810] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftFoundation.dylib
    [7811] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftCoreGraphics.dylib
    [7812] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftDispatch.dylib
    [7813] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftDarwin.dylib
    [7814] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftUIKit.dylib
    [7815] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftSwiftOnoneSupport.dylib
    [7816] /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator/libswiftObjectiveC.dylib</pre></td></tr></table>
</div>
</div>
<h3 id="段信息">段信息</h3>

<p>第二部分，主要编译阶段生成的 Section 信息。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></pre></td>
<td class="lntd">
<pre class="chroma">    # Sections:
    
    # Address Size Segment Section
    
    0x100002860 0x04B8E6AD __TEXT __text
    0x104B90F0E 0x0000A0B0 __TEXT __stubs
    0x104B9AFC0 0x00005C9A __TEXT __stub_helper
    0x104BA0C60 0x00259CBE __TEXT __cstring
    0x104DFA91E 0x00188A6C __TEXT __objc_methname
    0x104F8338A 0x0002E326 __TEXT __objc_classname
    0x104FB16B0 0x00066ABF __TEXT __objc_methtype
    0x105018170 0x000267C6 __TEXT __ustring
    0x10503E938 0x0029C500 __TEXT __gcc_except_tab
    0x1052DAE40 0x000CE490 __TEXT __const
    0x1053A92D0 0x000493AC __TEXT __swift3_typeref
    0x1053F267C 0x00017BCC __TEXT __swift3_capture
    0x10540A250 0x0000E6B7 __TEXT __swift3_reflstr
    0x105418908 0x000112EC __TEXT __swift3_fieldmd
    0x105429BF4 0x00002850 __TEXT __swift3_assocty
    0x10542C448 0x00007BA0 __TEXT __swift2_proto
    0x105433FE8 0x000011F0 __TEXT __swift2_types
    0x1054351D8 0x000007BC __TEXT __swift3_builtin
    0x105435994 0x00000378 __TEXT __entitlements
    0x105435D0C 0x0000037B __TEXT __dof_RACSignal
    0x105436087 0x000002E8 __TEXT __dof_RACCompou
    0x105436370 0x00069B70 __TEXT __unwind_info
    0x10549FEE0 0x0002D120 __TEXT __eh_frame
    0x1054CD000 0x00000010 __DATA __nl_symbol_ptr
    0x1054CD010 0x000037D0 __DATA __got
    0x1054D07E0 0x0000D640 __DATA __la_symbol_ptr
    0x1054DDE20 0x00000CC0 __DATA __mod_init_func
    0x1054DEAE0 0x00000008 __DATA __mod_term_func
    0x1054DEAF0 0x0019A0A0 __DATA __const
    0x105678B90 0x000E2940 __DATA __cfstring
    0x10575B4D0 0x0000DF48 __DATA __objc_classlist
    0x105769418 0x00000108 __DATA __objc_nlclslist
    0x105769520 0x00001468 __DATA __objc_catlist
    0x10576A988 0x000001D8 __DATA __objc_nlcatlist
    0x10576AB60 0x000022C0 __DATA __objc_protolist
    0x10576CE20 0x00000008 __DATA __objc_imageinfo
    0x10576CE28 0x005E2510 __DATA __objc_const
    0x105D4F338 0x0005EBB0 __DATA __objc_selrefs
    0x105DADEE8 0x000009B8 __DATA __objc_protorefs
    0x105DAE8A0 0x0000B890 __DATA __objc_classrefs
    0x105DBA130 0x000088B0 __DATA __objc_superrefs
    0x105DC29E0 0x00033288 __DATA __objc_ivar
    0x105DF5C68 0x0009EDB8 __DATA __objc_data
    0x105E94A20 0x0008EDE0 __DATA __data
    0x105F23800 0x0001A034 __DATA __bss
    0x105F3D840 0x00004168 __DATA __common</pre></td></tr></table>
</div>
</div>
<p>其中描述了各个段在可执行文件中的地址，具体的段大小以及该段的类别。从内容可以看到每个段的地址都是上一个段的地址+上一段的大小所得。 具体公式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">Address(n) = Address(n-1) + Size(n-1)</pre></td></tr></table>
</div>
</div>
<p>但是，因为编译器优化，会将段地址进行一定的偏移，让地址在带宽的整数倍位置启动，因此有可能会有不一致的情况，比如下面实际上看到的地址是 <strong>0x104B90F0E</strong>。官方文档有说明：</p>

<blockquote>
<p>For best performance, segments should be aligned on virtual memory page boundaries—4096 bytes for PowerPC and x86 processors. To calculate the size of a segment, add up the size of each section, then round up the sum to the next virtual memory page boundary (4096 bytes, or 4 kilobytes). Using this algorithm, the minimum size of a segment is 4 kilobytes, and thereafter it is sized at 4 kilobyte increments.</p>
</blockquote>

<p>其中第三列标记出了该段的类型，比如 代码段，数据段等信息，第四列列举除了真实代码块所对应生成的 Section， 这里需要给大家再强调下 Segment 和 Section 的区别和联系。</p>

<blockquote>
<p>我们知道 Mach-O 是 iOS 和 OSX 系统上使用的可执行文件格式类型，类似于 Linux 系统下的 ELF（Executable Linkable Format） 文件格式以及 Windows 上使用的 PE(Portable Executable) 文件格式，其本质上都是基于最早的 COFF（Common file format）的变种。其中有一个目前大家所熟知的就是针对参与编译的代码文件中不同部分的代码最后会被编译进入不同的 Section 中，比如代码段 .text 数据段 .data 等。后续在发展虚拟存储地址和内存物理地址的对应关系中，因为为了避免段过多导致的空间浪费问题，对于相同权限的段被合并到了一起作为一个段进行映射，前者就是之前的 section，后者就是 Segment。
实际上 Segment 的概念是从装载的角度重新划分了 ELF 文件的各个段。将目标文件链接成可执行文件的时候，链接器会尽量把相同权限属性的段分配在同一空间。在 ELF 中把这些属性相似的又连在一起的段叫做一个 Segment。
Segment 和 Section 是从不同的角度来划分同一个ELF文件。这个在ELF中被称为不同的视图（View），从“Section”的角度来看ELF文件就是链接视图（Linking View），从“Segment”的角度来看就是执行视图（Execution View）。当我们在谈到ELF装载时，“段”专门指“Segment”；而在其他的情况下，“段”指的是 Section。</p>
</blockquote>

<h3 id="符号信息">符号信息</h3>

<p>第三部分就是具体的每一项符号信息，具体是位置信息，比如在内存映像中的地址以及所属的文件是什么，第三列中的 Index 指的就是上面具体每一个 object file 列表中第一列的序号。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></pre></td>
<td class="lntd">
<pre class="chroma">    # Symbols:
    
    # Address Size File Name
    
    0x100002860 0x000000D0 [ 2] -[ZHEmailAutocompleteTextField initWithFrame:]
    0x100002930 0x00000690 [ 2] -[ZHEmailAutocompleteTextField setupAutocompleteTextField]
    0x100002FC0 0x000007B0 [ 2] -[ZHEmailAutocompleteTextField textField:completionForPrefix:ignoreCase:]
    0x100003770 0x00000030 [ 2] -[ZHEmailAutocompleteTextField emailDomains]
    0x1000037A0 0x00000040 [ 2] -[ZHEmailAutocompleteTextField setEmailDomains:]
    0x1000037E0 0x00000033 [ 2] -[ZHEmailAutocompleteTextField .cxx_destruct]
    0x100003820 0x00000020 [ 3] -[ZHURLProtocolStartupItem introduction]
    0x100003840 0x0000014A [ 3] -[ZHURLProtocolStartupItem execute:]
    
    ...
    
    0x104BA0C32 0x0000000A [7816] __T010ObjectiveC2eeoiSbAA8SelectorV_ADtF
    0x104BA0C3C 0x0000000A [7816] __T010ObjectiveC2eeoiSbSo8NSObjectC_ADtF
    0x104BA0C46 0x0000000A [7816] __T010ObjectiveC8SelectorV11descriptionSSvg
    0x104BA0C50 0x0000000A [7816] __T010ObjectiveC8SelectorV9hashValueSivg
    0x104BA0C60 0x00000027 [ 2] literal string: kNSObjectUpdateThemeNormalNotification
    0x104BA0C87 0x00000025 [ 2] literal string: kNSObjectUpdateThemeHighNotification
    0x104BA0CAC 0x0000000C [ 2] literal string: emailDomain
    0x104BA0CB8 0x0000000A [ 2] literal string: [gmail.com](http://gmail.com/)
    0x104BA0CC2 0x00000009 [ 2] literal string: [live.com](http://live.com/)
    0x104BA0CCB 0x0000000C [ 2] literal string: [hotmail.com](http://hotmail.com/)
    
    ...
    
    0x104DFA7D6 0x00000018 [7802] literal string: T@&#34;NSArray&#34;,R,N,V_codes
    0x104DFA7EE 0x00000011 [7805] literal string: kCFAllocatorNull
    0x104DFA7FF 0x0000001C [7805] literal string: CFDataCreateWithBytesNoCopy
    0x104DFA81B 0x0000001D [7805] literal string: CFPropertyListCreateWithData
    0x104DFA838 0x00000020 [7805] literal string: CFPropertyListCreateFromXMLData
    0x104DFA858 0x00000020 [7805] literal string: CFStringCreateWithCStringNoCopy
    0x104DFA878 0x00000015 [7805] literal string: CFDictionaryGetValue
    0x104DFA88D 0x0000000C [7805] literal string: CFGetTypeID
    0x104DFA899 0x00000012 [7805] literal string: CFStringGetTypeID
    0x104DFA8AB 0x00000013 [7805] literal string: CFStringGetCString
    0x104DFA8BE 0x0000000A [7805] literal string: CFRelease
    0x104DFA8C8 0x00000031 [7805] literal string: /System/Library/CoreServices/SystemVersion.plist
    0x104DFA8F9 0x00000016 [7805] literal string: IPHONE_SIMULATOR_ROOT
    0x104DFA90F 0x0000000F [7805] literal string: ProductVersion
    0x104DFA91E 0x0000000F [ 2] literal string: initWithFrame:
    0x104DFA92D 0x00000011 [ 2] literal string: setKeyboardType:
    0x104DFA93E 0x0000001B [ 2] literal string: setupAutocompleteTextField
    
    ...
    
    0x104F83383 0x00000007 [7802] literal string: _codes
    0x104F8338A 0x0000001D [ 2] literal string: ZHEmailAutocompleteTextField
    0x104F833A7 0x00000019 [ 2] literal string: ZHAutocompleteDataSource
    0x104F833C0 0x00000009 [ 2] literal string: NSObject
    0x104F833C9 0x00000002 [ 2] literal string:
    0x104F833CB 0x00000019 [ 3] literal string: ZHURLProtocolStartupItem
    
    ...
    
    0x104FB165B 0x00000016 [7802] literal string: PLCrashReporterConfig
    0x104FB1671 0x00000020 [7802] literal string: PLCrashUncaughtExceptionHandler
    0x104FB1691 0x0000001F [7802] literal string: PLCrashReportMachExceptionInfo
    0x104FB16B0 0x0000000B [ 2] literal string: B24@0:8@16
    0x104FB16BB 0x00000008 [ 2] literal string: #16@0:8
    0x104FB16C3 0x00000008 [ 2] literal string: @16@0:8
    0x104FB16CB 0x0000000B [ 2] literal string: @24@0:8:16
    0x104FB16D6 0x0000000E [ 2] literal string: @32@0:8:16@24
    0x104FB16E4 0x00000011 [ 2] literal string: @40@0:8:16@24@32
    0x104FB16F5 0x00000008 [ 2] literal string: B16@0:8
    
    ...
    
    0x10501808E 0x00000042 [7802] literal string: @228@0:8{plcrash_mach_exception_port_set=I[13I][13I][13i][13i]}16
    0x1050180D0 0x0000003E [7802] literal string: {plcrash_mach_exception_port_set=I[13I][13I][13i][13i]}16@0:8
    0x10501810E 0x00000061 [7802] literal string: {plcrash_mach_exception_port_set=&#34;count&#34;I&#34;masks&#34;[13I]&#34;ports&#34;[13I]&#34;behaviors&#34;[13i]&#34;flavors&#34;[13i]}
    0x105018170 0x0000002C [ 3] l_.str.465
    0x10501819C 0x0000000C [ 5] l_.str.5
    0x1050181A8 0x00000010 [ 5] l_.str.9
    0x1050181B8 0x0000000A [ 5] l_.str.13
    0x1050181C2 0x0000000E [ 5] l_.str.15
    0x1050181D0 0x00000042 [ 5] l_.str.17
    0x105018212 0x00000006 [ 5] l_.str.138
    
    ...</pre></td></tr></table>
</div>
</div>
<p>看到在 File 一列中的数字就指代第一部分统计出来的各个 .o 文件，比如下面前几行记录 File 为 2，也就是第一部分中记录的 ZHEmailAutocompleteTextField.o ，然后其中第一列地址是该符号在指定 .o 文件中的地址，我们通过看该地址能够知道其处于第二部分哪个段中，比如第一行的 <code>initWithFrame</code> 位于 <strong>TEXT.</strong>text 中，地址为 0x100002860，占用大小为 208 字节。</p>

<p>因此，比如我们要查找某一个 Symbol 所属的 Framework 的话，就能够通过 index 回溯到具体 object 文件。</p>

<h2 id="linkmap-能用来做什么">LinkMap 能用来做什么？</h2>

<p>既然了解了 LinkMap 具体的文件结构，我们能够用这个文件来做什么？</p>

<p>首先，是该文件列举了所有被打入可执行文件的库文件中所有的目标文件（理解一个目标文件就是一个 Source），无论是 framework 还是 静态库文件都有，并且给出了每个 Symbol 的信息，我们能够回溯到该 Symbol 对应的目标文件，进而能够知道该目标文件所处的 framework。</p>

<p>例如，如下图，从 bugly 上看到某一个 Crash 发生的地方，我们首先定位和知乎 App 本身相关的堆栈如下所示，从堆栈信息提取出具体的 Symbol 是 <code>[ZHPinTextView touchesEnded:withEvent:]</code></p>

<p><img src="https://i.imgur.com/pegf6J6.png" alt="" /></p>

<p>那我们通过在 LinkMap 文件中查找该符号，得到如下信息：</p>

<p><img src="https://i.imgur.com/IeWodUn.png" alt="" /></p>

<p>可以确定为 Index 为 5135 的目标文件中的 Symbol，那此时通过回溯 Object 文件，可以得到如下：</p>

<p><img src="https://i.imgur.com/tKUEqKE.png" alt="" /></p>

<p>这样就可以很确定该 Symbol 出自于 ZHModuleDB.framework 了。 这也是目前基础架构组正在开发的 Crash 分析分发平台 Argus 中分发前端 iOS 这一环得以实现定向分发的的基础。</p>

<p>其次，我们通过上面的文件结构可以知道每一个 Framework 都有多少 目标文件（.o 文件），并且每个 .o 文件的大小是多少，就可以算出来每个 framework 的总体大小。这样可以有两个事情：</p>

<ol>
<li>统计可执行包中每个业务模块具体占用可执行文件的大小以及占比</li>
<li>对比不同版本，可以知道每个具体模块新增文件大小，从而可以做出主动报警来对包体积大小做一定的控制</li>
</ol>

<h2 id="注意事项">注意事项：</h2>

<h3 id="关于-symbol-匹配规则">关于 Symbol 匹配规则</h3>

<p>因为真实的 Symbol 会被编译系统进行一定程度的签名，所以不能直接精准匹配，最好的方式是通过模糊查找，在实现的时候通过正则匹配或者尽可能的缩小 Symbol 查找精准度来做，还有就是 Swift 中的 Symbol 因为加入了 namespace 和 method overload 的概念导致符号信息更是不能完全匹配。</p>

<p>举个🌰：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">比如在 ZHPaymentSDK 中定义了某个 swift 类为  KMSubscriptionLauncher.swift 文件中定义个方法：</pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">@objc public func subscribe(withSkuID skuID: String?, autoRenewable: Bool = true, begin: SubscriptionBeginCallback?, cancel: SubscriptionCancelledCallback?, pollingBegin: SubscriptionBeginPollingCallback?, success: SubscriptionSuccessCallback?, failed: SubscriptionFailedCallback?) { }</pre></td></tr></table>
</div>
</div>
<p>生成对应符号的时候，系统就会把所有的可用的方法全生成出来，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></pre></td>
<td class="lntd">
<pre class="chroma">0x104587950 0x00000008 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFfA0*
    0x104587958 0x000004B0 [7834] __T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtF
    0x104587E08 0x00000038 [7834] l_objectdestroy
    0x104587E40 0x00000868 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU*
    0x1045886A8 0x000000F4 [7834] l_objectdestroy.8
    0x10458879C 0x00000078 [7834] __T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU_TA
    0x104588814 0x000000B4 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU_yAEcfU*
    0x1045888C8 0x00000244 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU_yAE_SaySSGSgtcfU0*
    0x104588B0C 0x000000B4 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU_yAEcfU1*
    0x104588BC0 0x00000168 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU_yAN_AEtcfU2*
    0x104588D28 0x00000164 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFyycfU_yAN_AEtcfU2_s23CustomStringConvertible_pyXKfu*
    0x104588E8C 0x00000134 [7834] _*T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFySo16ZHKMContractInfoCSg_ANtcfU0*
    0x104588FC0 0x0000005C [7834] l_objectdestroy.11
    0x10458901C 0x0000002C [7834] __T012ZHPaymentSDK22KMSubscriptionLauncherC9subscribeySSSg9withSkuID_Sb13autoRenewableyycSg5beginAH6cancelAH12pollingBeginAH7successys5Error_pSgcSg6failedtFySo16ZHKMContractInfoCSg_ANtcfU0_TA</pre></td></tr></table>
</div>
</div>
<p>这就是符号修饰和方法签名，越是复杂的语法，修饰机制越是复杂。比如大名鼎鼎的 C++ ，真的算是一门复杂语言了，其拥有类、继承、虚机制、重载、名称空间等这些特性，它们使得符号管理更为复杂。 专业术语叫 Name Mangling。 Swift 在一定程度上借鉴了其签名机制，不过我们不用深究，如果想知道其对应的原符号签名，使用现有工具即可。</p>

<p>XCode 有命令可以 demangle 这些符号，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">xcrun swift-demangle xxxxxxx</pre></td></tr></table>
</div>
</div>
<h2 id="crash-解析">Crash 解析</h2>

<p>以上，我们了解了 LinkMap 都是什么并且能够做什么了，用 Python 写了一段脚本，放在了 <a href="https://github.com/hechen/CrashReportParser">Github</a> 上，有兴趣可以用一下。</p>

<h2 id="参考链接">参考链接</h2>

<ol>
<li><a href="https://mikeash.com/pyblog/friday-qa-2014-08-15-swift-name-mangling.html">mikeash.com: Friday Q&amp;A 2014-08-15: Swift Name Mangling</a></li>
<li><a href="https://github.com/mattgallagher/CwlDemangle/">mattgallagher/CwlDemangle</a></li>
</ol>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">chen</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2019-04-01</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://hechen.xyz/tags/crash/">Crash</a>
          <a href="https://hechen.xyz/tags/linkmap/">LinkMap</a>
          <a href="https://hechen.xyz/tags/dispatch/">Dispatch</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/send-to-2do/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">如何制作 Send to 2Do 的 Safari 书签</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/reading-process/">
            <span class="next-text nav-default">阅读流程</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "hechen/Comments"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    显示 Disqus 评论
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://hechen.xyz/post/linkmap/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'stoneman';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:hechen.dream@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://stackoverflow.com/users/10229101/chen-he" rel="me noopener" class="iconfont"
      title="stack-overflow"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M809.714286 932.571429l-638.857143 0 0-274.285714-91.428571 0 0 365.714286 821.714286 0 0-365.714286-91.428571 0 0 274.285714zm-538.285714-299.428571l18.857143-89.714286 447.428571 94.285714-18.857143 89.142857zm58.857143-213.714286l38.285714-83.428571 414.285714 193.714286-38.285714 82.857143zm114.857143-203.428571l58.285714-70.285714 350.857143 293.142857-58.285714 70.285714zm226.857143-216l272.571429 366.285714-73.142857 54.857143-272.571429-366.285714zm-410.285714 840.571429l0-90.857143 457.142857 0 0 90.857143-457.142857 0z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/OgreMergO" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/hc2feifei" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>


<a href="https://hechen.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2015 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        chen
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  







  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script type="text/javascript">
    AV.initialize("wgbxcKzgAuMNE8wvfGp38xwG-gzGzoHsz", "JPVrQwSXVrxiVVsK3WoViro4");
  </script>

  <script>
    function showHitCount(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push($(this).attr("id").trim());
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var hits = item.get('hits');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(hits);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function (results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("hits");
            counter.save(null, {
              success: function (counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('hits'));
              },
              error: function (counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
             
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
             
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("hits", 1);
            newcounter.save(null, {
              success: function (newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('hits'));
              },
              error: function (newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function (error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function () {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        
        addCount(Counter);
      } else if ($('.post-link').length > 1) {
        
        showHitCount(Counter);
      }
    });
  </script>



  <script id="dsq-count-scr" src="//stoneman.disqus.com/count.js" async></script>





</body>
</html>
